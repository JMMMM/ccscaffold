# Continuous Learning - 持续学习功能

自动分析对话内容,检测反复修改失败的情况并生成修复 skill。

## 功能概述

Continuous Learning 是一个自动学习系统,可以:

1. **分析对话内容** - 检测用户反复要求修复同一个问题的情况(>=3次)
2. **总结规律和触发点** - 根据AI的工具使用模式,提取修复规律
3. **生成可复用 skill** - 自动生成修复 skill 并保存到 `skills/learns` 目录
4. **避免重复分析** - 通过状态管理记录已处理的对话行数

## 使用方法

### 触发分析

在对话中输入命令:

```
/summary-skills
```

系统会自动:
1. 读取当前会话文件
2. 从上次记录的位置开始分析新内容
3. 检测反复修复模式
4. 生成对应的 skill 文件
5. 更新处理位置

### 检测条件

系统会在以下情况生成 skill:

- 用户反复要求修复同一个问题 **>= 3次**
- 包含关键词: 修复、修正、解决、还是不行、仍然、继续、fix、error、失败、错误、问题

### 生成的 Skill 内容

每个自动生成的 skill 包含:

- **问题概述** - 检测到的问题主题和修复次数
- **触发点识别** - 何时应该参考此 skill
- **修复规律总结** - 问题模式和解决方案模式
- **使用的工具** - AI 工具使用模式
- **修复流程建议** - 基于历史的建议处理步骤
- **对话记录片段** - 第一次和最后一次尝试的内容

## 文件结构

```
skills/
├── continuous-learning/
│   ├── skill.json              # Skill 配置文件
│   ├── scripts/
│   │   └── summary_skills.py   # 分析脚本
│   └── state.json              # 状态文件(自动生成)
└── learns/                     # 自动生成的 skill 存放目录
    └── fix-xxx-timestamp.md    # 生成的修复 skill
```

## 状态管理

### state.json 结构

```json
{
  "conversation-20260209.txt": {
    "last_line": 150,
    "first_analyzed": "2026-02-09T10:30:00",
    "last_analyzed": "2026-02-09T15:45:00",
    "skills_generated": [
      {
        "name": "fix-example-1234567890",
        "generated_at": "2026-02-09T15:45:00",
        "processed_line": 150
      }
    ]
  }
}
```

### 避免重复分析

- 每次分析时,系统会读取 `state.json` 中记录的 `last_line`
- 从该行号之后开始读取对话内容
- 分析完成后,更新 `last_line` 到最后一个用户消息的行号
- 这样可以避免重复分析已处理的内容

## 配置

修改 `skills/continuous-learning/skill.json` 可以调整配置:

```json
{
  "configuration": {
    "learns_dir": "skills/learns",
    "retry_threshold": 3
  }
}
```

- `learns_dir`: 生成的 skill 存放目录
- `retry_threshold`: 触发分析的最小修复次数(默认为3)

## 示例

### 输入

```
用户: 请帮我修复这个错误
AI: [尝试修复]
用户: 还是不行,请修复
AI: [再次尝试]
用户: 仍然有问题,继续修复
AI: [第三次尝试]
```

### 触发命令

```
/summary-skills
```

### 输出

```
检测到 1 个反复修复模式

============================================================
模式 1/1
============================================================
问题: 错误
修复次数: 3
已生成 skill: skills/learns/fix-error-20260209154500.md

分析完成! 共生成 1 个 skill
已更新处理位置到第 150 行
```

## 注意事项

1. **手动触发** - 需要手动输入 `/summary-skills` 命令来触发分析
2. **学习质量** - 生成的 skill 质量取决于对话内容的完整性
3. **定期清理** - 建议定期检查 `skills/learns` 目录,合并或删除重复的 skill
4. **人工审核** - 自动生成的 skill 应该进行人工审核和优化

## 未来改进

- [ ] 支持自动触发(达到阈值时自动分析)
- [ ] 支持相似 skill 合并
- [ ] 支持自动优化和更新现有 skill
- [ ] 添加 skill 效果评估机制
